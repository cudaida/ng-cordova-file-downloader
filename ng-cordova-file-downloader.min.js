angular.module("com.verico.ng-cordova-file-downloader",[]),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileDownloaderList",["$q","$timeout","fileDownloaderSingle",function(a,b,c){function d(a,b){var c,d=10;return c=b.length>a+(d-1)?b.slice(a,a+d):b.slice(a,b.length)}function e(b,d){function e(a){f.resolve(a)}var f=a.defer(),g=[];return b.forEach(function(a){var b=c.downloadFileFromUrl(a.url,a.name,d);g.push(b)}),a.allSettled(g).then(e,e),f.promise}return{downloadFileList:function(c,f){function g(a){a.forEach(function(a){k.push(a)}),b(function(){if(n<c.length&&!i){var a=d(n,c);n+=a.length,e(a,f).then(g)}else h.resolve(k)},0),j+=a.length,h.notify(l)}var h=a.defer(),i=!1,j=0,k=[],l={getCount:function(){return j},shouldCancel:function(a){i=a}},m=d(0,c),n=m.length;return e(m,f).then(g),h.promise}}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileDownloaderSingle",["$q","$timeout","$injector","fileTransferService","downloadFileSystemHelper","downloadFeedbackFactory",function(a,b,c,d,e,f){function g(b,c,f){var g=a.defer();return e.getFullFilePath().then(function(a){var e=a+c,h=d.getFileTransfer(),j=encodeURI(b),k={};i&&(k={Authorization:i.getLoginInfo()}),h.download(j,e,function(a){g.resolve("function"==typeof a.toURL?a.toURL():a.fullPath)},function(a){g.reject("Image download failed:"+JSON.stringify(a))},!1,{headers:k}),f&&void 0!==f.timeout&&null!==f.timeout},g.reject),g.promise}function h(b,c,d){var h=a.defer();return e.checkIfFileExists(c).then(h.resolve,function(){g(b,c,d).then(function(a){h.resolve(f.feedback(!0,b,c,a))},function(){h.reject(f.feedback(!1,b,c))})}),h.promise}var i,j=e.setSaveFolderPath;try{i=c.get("appSettings")}catch(k){}return{downloadFileFromUrl:h,setSaveFolderPath:j}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("ngCordovaFileDownloader",["fileDownloaderSingle","fileDownloaderList",function(a,b){return{setSaveFolder:a.setSaveFolderPath,downloadFile:a.downloadFileFromUrl,downloadFileList:b.downloadFileList}}])}(),angular.module("com.verico.ng-cordova-file-downloader").config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){var b=a;return b.allSettled=b.allSettled||function(a){var c=b.defer();if(!angular.isArray(a))throw"allSettled can only handle an array of promises (for now)";var d=[],e=[],f=!1;angular.forEach(a,function(a,b){d[b]=!1});var g=function(a,b,c,d){var e=!0;angular.forEach(a,function(a){a||(e=!1)}),e&&(d?c.reject(b):c.resolve(b))};return angular.forEach(a,function(a,h){b.when(a).then(function(a){d[h]=!0,e[h]=a,g(d,e,c,f)},function(a){d[h]=!0,e[h]=a,f=!0,g(d,e,c,f)})}),c.promise},b}])}]),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("downloadFeedbackFactory",function(){return{feedback:function(a,b,c,d){return{success:a,url:b,name:c,fullPath:d}}}})}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("downloadFileSystemHelper",["$q","$timeout","fileTransferService","downloadFeedbackFactory",function(a,b,c,d){function e(a){console.log("Error:"+JSON.stringify(a))}function f(b){var d=a.defer();return c.getFileSystem().then(function(a){a.root.getDirectory(b,{create:!0,exclusive:!1},function(){d.resolve(b)},function(a){e(a),d.reject(a)})},function(a){e(a),d.reject(a)}),d.promise}function g(){var b=a.defer();return null===k?f(j).then(function(a){c.getFileSystem().then(function(c){var d=a+"/dummy.html";c.root.getFile(d,{create:!0,exclusive:!1},function(a){k="function"==typeof a.toURL?a.toURL().replace("dummy.html",""):a.fullPath.replace("dummy.html",""),b.resolve(k)},function(a){e(a),b.reject(a)})})},b.reject):b.resolve(k),b.promise}function h(b){return c.getFileSystem().then(function(c){var e=a.defer(),f=j+"/"+b;return c.root.getFile(f,{create:!1,exclusive:!1},function(a){var c;c="function"==typeof a.toURL?a.toURL():a.fullPath,e.resolve(d.feedback(!0,"",b,c))},e.reject),e.promise})}function i(a){j=a}var j="com.verico.file-default",k=null;return{checkIfFileExists:h,setSaveFolderPath:i,getFullFilePath:g}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileTransferService",["$q","$window",function(a,b){return{getFileSystem:function(){var c=a.defer();return b.requestFileSystem(b.PERSISTENT,1048576,c.resolve,c.reject),c.promise},getFileTransfer:function(){return new FileTransfer}}}])}();