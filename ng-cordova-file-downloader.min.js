angular.module("com.verico.ng-cordova-file-downloader",[]),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileDownloaderList",["$q","$timeout","appSettings","fileDownloaderSingle",function(a,b,c,d){function e(a,b){var c,d=10;return c=b.length>a+(d-1)?b.slice(a,a+d):b.slice(a,b.length)}function f(b){function c(a){e.resolve(a)}var e=a.defer(),f=[];return b.forEach(function(a){var b=d.downloadFileFromUrl(a.url,a.name);f.push(b)}),a.allSettled(f).then(c,c),e.promise}return{downloadFileList:function(c){function d(a){a.forEach(function(a){j.push(a)}),b(function(){if(m<c.length&&!h){var a=e(m,c);m+=a.length,f(a).then(d)}else g.resolve(j)},0),i+=a.length,g.notify(k)}var g=a.defer(),h=!1,i=0,j=[],k={getCount:function(){return i},shouldCancel:function(a){h=a}},l=e(0,c),m=l.length;return f(l).then(d),g.promise}}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileDownloaderSingle",["$q","$timeout","appSettings","fileTransferService","downloadFileSystemHelper","downloadFeedbackFactory",function(a,b,c,d,e,f){function g(b,f){var g=a.defer();return e.getFullFilePath().then(function(a){var e=a+f,h=d.getFileTransfer(),i=encodeURI(b),j={};c&&(j={Authorization:c.getLoginInfo()}),h.download(i,e,function(a){g.resolve("function"==typeof a.toURL?a.toURL():a.fullPath)},function(a){g.reject("Image download failed:"+JSON.stringify(a))},!1,{headers:j})},g.reject),g.promise}function h(b,c){var d=a.defer();return e.checkIfFileExists(c).then(d.resolve,function(){g(b,c).then(function(a){d.resolve(f.feedback(!0,b,c,a))},function(){d.reject(f.feedback(!1,b,c))})}),d.promise}var i=e.setSaveFolderPath;return{downloadFileFromUrl:h,setSaveFolderPath:i}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("ngCordovaFileDownloader",["fileDownloaderSingle","fileDownloaderList",function(a,b){return{setSaveFolder:a.setSaveFolderPath,downloadFile:a.downloadFileFromUrl,downloadFileList:b.downloadFileList}}])}(),angular.module("com.verico.ng-cordova-file-downloader").config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){var b=a;return b.allSettled=b.allSettled||function(a){var c=b.defer();if(!angular.isArray(a))throw"allSettled can only handle an array of promises (for now)";var d=[],e=[],f=!1;angular.forEach(a,function(a,b){d[b]=!1});var g=function(a,b,c,d){var e=!0;angular.forEach(a,function(a){a||(e=!1)}),e&&(d?c.reject(b):c.resolve(b))};return angular.forEach(a,function(a,h){b.when(a).then(function(a){d[h]=!0,e[h]=a,g(d,e,c,f)},function(a){d[h]=!0,e[h]=a,f=!0,g(d,e,c,f)})}),c.promise},b}])}]),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("downloadFeedbackFactory",function(){return{feedback:function(a,b,c,d){return{success:a,url:b,name:c,fullPath:d}}}})}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("downloadFileSystemHelper",["$q","$timeout","appSettings","fileTransferService","downloadFeedbackFactory",function(a,b,c,d,e){function f(a){console.log("Error:"+JSON.stringify(a))}function g(b){var c=a.defer();return d.getFileSystem().then(function(a){a.root.getDirectory(b,{create:!0,exclusive:!1},function(){c.resolve(b)},function(a){f(a),c.reject(a)})},function(a){f(a),c.reject(a)}),c.promise}function h(){var b=a.defer();return null===l?g(k).then(function(a){d.getFileSystem().then(function(c){var d=a+"/dummy.html";c.root.getFile(d,{create:!0,exclusive:!1},function(a){l="function"==typeof a.toURL?a.toURL().replace("dummy.html",""):a.fullPath.replace("dummy.html",""),b.resolve(l)},f)})}):b.resolve(l),b.promise}function i(b){return d.getFileSystem().then(function(c){var d=a.defer(),f=k+"/"+b;return c.root.getFile(f,{create:!1,exclusive:!1},function(a){var c;c="function"==typeof a.toURL?a.toURL():a.fullPath,d.resolve(e.feedback(!0,"",b,c))},d.reject),d.promise})}function j(a){k=a}var k="com.verico.file-default",l=null;return{checkIfFileExists:i,setSaveFolderPath:j,getFullFilePath:h}}])}(),function(){"use strict";angular.module("com.verico.ng-cordova-file-downloader").service("fileTransferService",["$q","$window",function(a,b){return{getFileSystem:function(){var c=a.defer();return b.requestFileSystem(b.PERSISTENT,1048576,c.resolve,c.reject),c.promise},getFileTransfer:function(){return new FileTransfer}}}])}();